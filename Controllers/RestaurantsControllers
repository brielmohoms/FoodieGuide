using System.Linq;
using Microsoft.AspNetCore.Mvc;
using Umbraco.Cms.Web.Common.Controllers;
using Umbraco.Cms.Core.Models.PublishedContent;
using Umbraco.Cms.Web.Common.PublishedModels;

public class RestaurantsController : RenderController
{
    public RestaurantsController(
        ILogger<RestaurantsController> logger,
        ICompositeViewEngine engine,
        IUmbracoContextAccessor accessor) : base(logger, engine, accessor) { }

    public override IActionResult Index()
    {
        var cat = Request.Query["browseCategories"].ToString().ToLowerInvariant();

        var allRestaurants = Umbraco.ContentAtRoot().DescendantsOrSelfOfType("restaurantPage")

        var filtered = allRestaurants.Where(r => r.Value<string[]>("category") != null
        && r.Value<string[]>("category")
        .Any(x => x.Equals(cat, StringComparison.InvariantCultureIgnoreCase))).ToList();

        ViewData["CategoryAlias"]    = cat;
        ViewData["RestaurantResults"] = filtered;

        return CurrentTemplate(model: CurrentPage);
    }
    
}