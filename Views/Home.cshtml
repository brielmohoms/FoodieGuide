@{
	Layout = "master.cshtml";
}
@using System
@using System.Collections.Generic
@using System.Linq
@using Umbraco.Cms.Core.Models.PublishedContent
@using Umbraco.Extensions
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<IPublishedContent>

@{
    // 1) Point to your master layout
    Layout = "master.cshtml";

    // 2) Pull the restaurants you picked in the back-office
    var slides = Model.Value<IEnumerable<IPublishedContent>>("sliderRestaurants")
                 ?? Enumerable.Empty<IPublishedContent>();
    var first = true;

    var introImage = Model.Value<IPublishedContent>("introImage");
}

@if (slides.Any())
{
  <!-- 3) Bootstrap carousel markup -->
  <div id="restaurantCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
    <div class="carousel-inner">
      @foreach (var r in slides)
      {
          // Capture the data for this slide
          var img = r.Value<IPublishedContent>("image")?.Url();
          var name = r.Value<string>("restaurantName");
          var desc = r.Value<string>("description") ?? "";
            
          var snippet = desc.Length > 80 
            ? desc.Substring(0, 80) + "…" 
            : desc;
        
        <div class="carousel-item @(first ? "active" : "")">
          <img src="@img" class="d-block w-100" alt="@name" />
          <div class="carousel-caption d-none d-md-block">
            <h5>@name</h5>
            <p>@snippet</p>
          </div>
        </div>
        first = false;
      }
    </div>

    <!-- Controls -->
    <button class="carousel-control-prev" type="button" data-bs-target="#restaurantCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#restaurantCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
      <span class="visually-hidden">Next</span>
    </button>

    <!-- Indicators -->
    <div class="carousel-indicators">
      @for (int i = 0; i < slides.Count(); i++)
      {
        <button type="button"
                data-bs-target="#restaurantCarousel"
                data-bs-slide-to="@i"
                class="@(i == 0 ? "active" : "")"
                aria-current="@(i == 0 ? "true" : "false")"
                aria-label="Slide @(i + 1)">
        </button>
      }
    </div>
  </div>
}

else
{
  <p class="text-center text-muted">No restaurants selected for the slider.</p>
}

<section id="intro" class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 text-center">
      <img
          src="@(introImage.Url())"
          alt="Welcome to FoodieGuide"
          class="img-fluid mb-4"
          style="max-width:600px;"
        />
      <h1>HELLO & WELCOME</h1>
      @Html.Raw(Model.Value("introText"))
    </div>
  </div>
</section>
