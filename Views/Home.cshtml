@{
	Layout = "master.cshtml";
}
@using System
@using System.Collections.Generic
@using System.Linq
@using Umbraco.Cms.Core.Models.PublishedContent
@using Umbraco.Extensions
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<IPublishedContent>

@{
    // 1) Point to your master layout
    Layout = "master.cshtml";

    // 2) Pull the restaurants you picked in the back-office
    var slides = Model.Value<IEnumerable<IPublishedContent>>("sliderRestaurants")
                 ?? Enumerable.Empty<IPublishedContent>();
    var first = true;

    var introImage = Model.Value<IPublishedContent>("introImage");

    var cats = Model.Value<IEnumerable<IPublishedContent>>("browseCategories")
               ?? Enumerable.Empty<IPublishedContent>();

    var featuredItems = Model.Value<IEnumerable<IPublishedContent>>("weeklyFavorite") 
                        ?? Enumerable.Empty<IPublishedContent>();
      
}

@if (slides.Any())
{
  <!-- 3) Bootstrap carousel markup -->
  <div id="restaurantCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
    <div class="carousel-inner">
      @foreach (var r in slides)
      {
          // Capture the data for this slide
          var img = r.Value<IPublishedContent>("image")?.Url();
          var name = r.Value<string>("restaurantName");
          var desc = r.Value<string>("description") ?? "";
            
          var snippet = desc.Length > 80 
            ? desc.Substring(0, 80) + "…" 
            : desc;
        
        <div class="carousel-item @(first ? "active" : "")">
          <img src="@img" class="d-block w-100" alt="@name" />
          <div class="carousel-caption d-none d-md-block">
            <h5>@name</h5>
            <p>@snippet</p>
          </div>
        </div>
        first = false;
      }
    </div>

    <!-- Controls -->
    <button class="carousel-control-prev" type="button" data-bs-target="#restaurantCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#restaurantCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
      <span class="visually-hidden">Next</span>
    </button>

    <!-- Indicators -->
    <div class="carousel-indicators">
      @for (int i = 0; i < slides.Count(); i++)
      {
        <button type="button"
                data-bs-target="#restaurantCarousel"
                data-bs-slide-to="@i"
                class="@(i == 0 ? "active" : "")"
                aria-current="@(i == 0 ? "true" : "false")"
                aria-label="Slide @(i + 1)">
        </button>
      }
    </div>
  </div>
}

else
{
  <p class="text-center text-muted">No restaurants selected for the slider.</p>
}

<section id="intro" class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 text-center">
      <img
          src="@(introImage.Url())"
          alt="Welcome to FoodieGuide"
          class="img-fluid mb-4"
          style="max-width:300px;"
        />
      <h1>HELLO & WELCOME</h1>
      @Html.Raw(Model.Value("introText"))
    </div>
  </div>
</section>

<section id="categories" class="container py-5">
    <h2 class="text-center mb-4">What are you in the mood for?</h2>

    <ul class="list-unstyled d-flex flex-wrap justify-content-center category-list">
      @foreach (var c in cats)
      {
        var img = c.Value<IPublishedContent>("image")?.Url();
        <li class="category-item mx-2">
          <a href="@c.Url()" style="--bg:url('@img')" class="d-flex flex-column justify-content-between align-items-center">
            <div class="category-icon">
              @* You can swap these spans for <img> or SVG icons *@
              <span class="fi fi-@c.Name.ToLower()"></span>
            </div>
            <div class="category-label">@c.Name</div>
          </a>
        </li>
      }
    </ul>
</section>

<section id="featured" class="container py-5">
    <h2 class="text-center mb-4">Restaurant of the Week</h2>

    @foreach (var item in featuredItems)
    {
      var imgUrl = item.Value<IPublishedContent>("image")?.Url();
      var name   = item.Value<string>("restaurantName") ?? item.Name;
      var desc   = item.Value<string>("description") ?? "";
      var category   = item.Value<IEnumerable<IPublishedContent>>("category") 
                   ?? Enumerable.Empty<IPublishedContent>();
      var rating = item.Value<int?>("rating") ?? 0;

      <div class="featured-card d-flex mb-4 shadow-sm rounded overflow-hidden">
        <!-- IMAGE LEFT -->
        <div class="card-img-left flex-shrink-0">
          <img src="@imgUrl" alt="@name" class="h-100 object-fit-cover" />
        </div>

        <!-- CONTENT RIGHT -->
        <div class="card-body flex-grow-1 p-4">
          <h3 class="h5 mb-2">@name</h3>
          <p class="text-muted mb-3">@desc</p>

          @if (category.Any())
          {
            <div class="mb-2">
              <strong>Category:</strong>
              @string.Join(", ", category.Select(c => c.Name))
            </div>
          }
          
          <div class="rating">
            @for (int i = 1; i <= 5; i++)
            {
              if (i <= rating)
              {
                <i class="bi bi-star-fill text-warning"></i>
              }
              else
              {
                <i class="bi bi-star text-warning"></i>
              }
            }
          </div>
        </div>
      </div>
    }
  </section>


