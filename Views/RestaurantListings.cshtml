@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<IPublishedContent>
@using Umbraco.Cms.Core.Models.PublishedContent
@using Umbraco.Extensions

@{
  Layout = "master.cshtml";

  var current = Model;  

  var restaurantListings = Umbraco.ContentAtRoot()
    .First(x => x.ContentType.Alias == "restaurantListings");

  var restaurants = restaurantListings.DescendantsOfType("restaurantPage")
    .ToArray();

  var byCategory = restaurants.
    GroupBy(r => r.Value<IEnumerable<IPublishedContent>>("category")
    .FirstOrDefault()).ToArray();

}


<section class="container my-5" style="text-align:center">
  <h1>Restaurants</h1>

  @foreach (var grp in byCategory)
{
    var cat = grp.Key;
    var catName = cat?.Name ?? "Uncategorized";

    <section class="my-5">
      <h4>Restaurants offering @catName</h4>

      <div id="carousel-@catName.GetHashCode()"

        class="carousel slide"
        data-bs-ride="carousel">

        <div class="carousel-inner">

          @{
            var first = true;

            foreach (var page in grp)
            {

              // pull into locals
              var name = page.Value<string>("restaurantName");
              var desc = page.Value<string>("description");
              var img  = page.Value<IPublishedContent>("image")?.Url();
              var url  = page.Url();

            <div class="carousel-item @(first ? "active" : "")">

              <div class="card mx-2" style="width: 18rem">

                <img src="@img" class="card-img-top" alt="@name" />

                <div class="card-body d-flex flex-column">
                  <h5 class="card-title">@name</h5>
                  <p class="card-text flex-fill">@desc</p>
                  <a href="@url" class="btn btn-primary mt-2">View →</a>
                </div>
              </div>

            </div>

          first = false;
            }
          }

        </div>

      <button class="carousel-control-prev"
        type="button"
        data-bs-target="#carousel-@catName.GetHashCode()"
        data-bs-slide="prev">
          <span class="carousel-control-prev-icon"></span>
      </button>

      <button class="carousel-control-next"
        type="button"
        data-bs-target="#carousel-@catName.GetHashCode()"
        data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
      </button>
    </div>
  </section>
}

</section>

